<div class="wrapper">
  <div class="wrapper-menu" ng-include src="'partials/menu.html'"></div>
  <div class="wrapper-page">
    <div id="title">
      <h1>Messages</h1>
      <p  translate="MESSAGES.MATCHES_COUNT"
         translate-values="{ count: conversationCount }" > 35 conversations</p>
    </div>
    <div class="wrapper-messages">
    <div id="match-list" ng-class="showExtra && 'more-info'">
      <div class="scrollable-matchlist">
        <div ng-repeat="match in conversations | orderObjectBy:'lastActive':true track by match.matchId"
          ng-click="open(match.matchId)"
          ng-class="{true: 'selected'}[currentMatch === match.matchId]"
          class="match">
          <div class="image-wrapper">
            <img ng-src="{{match.thumbnail || 'img/anonymous.png'}}" class="thumbnail"/>
          </div>
          <div class="info-container">
            <div class="name">
              {{match.name || 'Unknown'}}
              <i ng-show="match.isSuperLike" class="fa fa-star "></i>
              <i ng-if="lastMessage(match) == 'sent'" class="fa fa-eye-slash pink"></i>
              <i ng-if="lastMessage(match) == 'seen'" class="fa fa-eye pink"></i>
              <i ng-if="lastMessage(match) == 'new'" class="fa fa-comment pink"></i>
            </div>
            <div class="info" ng-show="showExtra && match.infoUpdateTime">
              <i class="fa fa-map-marker"></i> {{match.userDistance | distanceToUnits}} 
              <i class="fa fa-bolt"></i> <span short-time-ago="{{match.userPingTime}}"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="conversation" ng-show="conversation">
      <div class="message-header">
        <div class="chat-with">
          <a ng-href="#/profile/{{conversation.userId}}">
            <button>{{'PROFILE.TITLE' | translate}}</button>
          </a>
        </div>
        <div class="match-options">
          <a ng-click="unmatch(conversation)">
            <button>{{'MESSAGES.UNMATCH' | translate}}</button>
          </a>
        </div>
      </div>
      <div class="messages-list-container">
        <div ng-show="conversation.messages.length == 0" class="messages-list-empty"
         translate="MESSAGES.NO_MESSAGES">
        </div>
        <div class="messages-list">
          <!-- normal messages -->
          <div ng-repeat-start="message in conversation.messages track by $index"
            ng-click="$showTimeStamp = !$showTimeStamp"
            class="{{message.fromMe ? 'from-me' : 'from-them'}}">
              <div class="message-text" ng-if="message.text"
                ng-bind-html="message.text"></div>
              <div class="message-date {{message.fromMe ? 'from-me-date sentAt' : 'from-them-date sentAt'}}"
                ng-class="{true: 'bounceIn', false: 'bounceOut'}[$showTimeStamp === true]">
                {{message.sentDate | timeToLocalized}}
              </div>
          </div>
          <div ng-repeat-end class="clear" scroll-to-last></div>
          <!-- pending messages -->
          <div ng-repeat-start="message in conversation.pending track by $index"
            class="from-me">
            <div class="pending-message">{{message}}</div>
          </div>
          <div ng-repeat-end class="messages-in-chat" scroll-to-last></div>
        
        </div>
      </div>
      <div class="messages-textarea">
        <input ng-keypress="keypress($event)" ng-model="message" placeholder="{{'MESSAGES.MESSAGE_PLACEHOLDER' | translate}}">
      </div>
    </div>
    </div>
  </div>
</div>
